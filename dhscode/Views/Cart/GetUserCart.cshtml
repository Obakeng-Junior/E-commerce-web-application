@model Cart

@{
	ViewData["Title"] = "GetUserCart";
}

<h3>My Cart</h3>


<div style="width:100%;margin:auto">
	@if (Model != null && Model.CartDetails != null && Model.CartDetails.Count > 0)
	{

		<div id="pdf">
			<h2 style="display: none;" id="pdf-heading" class="mb-3 d-flex justify-content-center">Dark Hawk Security - Quote</h2> <!-- Heading for PDF only -->

			<table class="table table-bordered">
				<tr>
					<th>Product</th>
					<th>Image</th>
					<th>Brand</th>
					<th>Unit Price</th>
					<th>Description</th>
					<th>Quantity</th>
					<th>Total Price</th>
				</tr>
				@foreach (var item in Model.CartDetails)
				{
					<tr>
						<td>@item.Product.Name</td>
						<td>
							@if (string.IsNullOrEmpty(item.Product.Image))
							{
								<img src="/images/default.jpg" style="width:80px;height:100px" />
							}
							else
							{
								<img src="/images/@item.Product.Image" style="width:80px;height:100px" />
							}
						</td>
						<td>@item.Product.Brand</td>
						<td>@item.Product.Price</td>
						<td>@item.Product.Description</td>
						<td>@item.Quantity</td>
						<td>@(item.Product.Price * @item.Quantity)</td>
						<td class='hide-from-pdf'>
							<!-- Hide these buttons in PDF -->
							@if (item.Quantity < item.Product.Stock.Quantity)
							{
								<a class="btn btn-info" href="/Cart/IncreaseItem?productId=@item.ProductId&&redirect=1">+</a>
							}
							<a class="btn btn-info" href="/Cart/RemoveItem?productId=@item.ProductId&&redirect=1">-</a>
						</td>
					</tr>
				}
			</table>

			<div class="my-2">
				<h5>Total: </h5> @(Model.CartDetails.Select(item => item.Product.Price * item.Quantity).Sum())
			</div>
		</div>

		<div class='hide-from-pdf'>
			<div class='my-2'>
				<a class="btn btn-primary" href="/Cart/Pay">Checkout</a>
				<a class="btn btn-secondary" id="printPDF">Download quote</a>
			</div>
		</div>
	}
	else
	{
		<div class="alert alert-info text-center" role="alert">
			<i class="bi bi-exclamation-circle"></i> Your cart is empty.
		</div>
	}
</div>



@section scripts {
	<script>
		$("#printPDF").click(function () {
			// Show the custom PDF heading
			document.getElementById('pdf-heading').style.display = 'block';

			// Hide elements with the 'hide-from-pdf' class
			$('.hide-from-pdf').hide();

			// Generate the PDF
			var element = document.getElementById('pdf');
			html2pdf().from(element).set({
				margin: [10, 10],
				pagebreak: { avoid: 'tr' },
				jsPDF: { orientation: 'landscape', unit: 'pt', format: 'letter', compressPDF: true }
			}).save().then(function () {
				// Restore original visibility after PDF download
				document.getElementById('pdf-heading').style.display = 'none';
				$('.hide-from-pdf').show();
			});
		});
	</script>
}





